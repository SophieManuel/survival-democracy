---
title: "Présentation HMMA236"
subtitle: "Démocraties et non-démocraties"
author: 
 - "Sophie Manuel"
 - "Anas Zakroum"
date: "21/03/2021"
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhead[L]{Projet}
  - \fancyhead[R]{\emph{M1 - Biostatistique}}
  - \usepackage{dsfont}
  - \usepackage{subfig}
  - \usepackage{amsmath}
  - \usepackage{amssymb}
  - \usepackage{amsthm}
  - \usepackage{amsmath}
output:
  pdf_document: 
    toc_depth: 5
    number_sections: yes
    keep_tex: yes
    extra_dependencies: dsfont
---
\newtheorem{definition}{Définition}
\newtheorem{exemple}{Exemple}
\newtheorem{corollary}{Corollaire}
\newtheorem*{proposition}{Proposition}
\newtheorem{lemma}{Lemme}
\newtheorem*{demonstration}{Démonstration}
\newtheorem{remark}{Remarque}
\newtheorem{propetie}{Propriété}
\newpage
\tableofcontents
\newpage
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r library}
library(dplyr)
library(survival)
library(survminer)
library(timereg)
```

\section{Consignes}

- var de durée , évènement intérêt
- variable étudié : type de régime
- taux de censure
- nature : qualitative

\subsection{Analyse de données}

- modèles de survie paramétriques (régression log-lin): Weibull, log-norm, `survreg`

- modèle cox non-param: `coxph`

- comparaison coeff (attention graphiques)

\subsection{Conclusion}
bilan + autre perspectives envisageables



\newpage

\section{Introduction}

  Dans ce rapport nous avons cherché à comparer des modèles d'analyse de survie paramétriques et non-paramétriques sur un jeu de données ainsi que l'influence d'une covarianble sur la survie. Ici, nous traiterons surtout les modèles paramétriques vu au cours du semestre, les modèles non-paramétriques ayant été vu durant le semestre dernier (pour approfondir ce type de modèle vous pouvez retrouver notre travail ici [lien]).
 
 
  
  Lorsqu'on travaille avec des modèles de survie, on chercher à étudier des durées de survie d'une population donnée.  
La **durée de vie** (ou de survie) est le temps écoulé du début du suivi de l'individu (naissance) jusqu'à l'apparition de l'*évènement d'intérêt* (décès) pour les individus d'une population. On la note souvent $T$
  
  
  Dans notre étude, nous utiliserons un jeu de données sur les chefs d'états en place dans le monde entre 1946 et 2008, soit environ 1800 chefs d'états de 202 pays différents sur plus d'un demi siècle. 
  
  
```{r,out.width="50%",fig.align="center",echo = FALSE, include=TRUE}
# Read file
df <- read.csv(file = 'dd.csv', sep = ",", header= TRUE)
df <- as_tibble(df)

df <- df %>% ungroup() %>% select(-cowcode2,-politycode, - end_year)
sample <- sample_n(df,4)

sample <- sample %>% select(-un_region_name,-leaderspellreg,-democracy, -un_continent_name)
sample <- rename(sample,Gouv = ehead, Pays = ctryname, Régime = regime, "Date d'entrée" = start_year, Durée = duration, Statut = observed)

knitr::kable(sample,align = 'c')
```
  
  Donc en termes de survie, les individus sont les chefs d'état, la durée de survie est la durée du mandat, l'évènement d'intérêt est la fin du mandat.
  
  
  Puisque nous sommes dans le cadre des modèles de survie, nous n'avons pas toujours toutes les informations sur l'individu, dans le sens où son suivi dans l'étude peut être interrompu, c'est-à-dire que l'évènement d'intérêt n'est pas observé durant l'étude. On appelle ce phénomène la **censure**. Elle est codée comme une indicatrice de l'observation de l'évènement d'interêt : 1 si l'évènement est observé, 0 sinon.

*Formule ?* 
 
  Dans notre cas, la colonne **Statut** représente la censure. On se retrouvera donc confronté à de la censure (aléatoire et fixe) à droite, ceci signifie que l'évènement d'intérêt ne sera pas observé avant la fin de l'étude. 
Les cas de censures fixes sont les chefs d'état encore au pouvoir en 2008 (fin de l'étude).
Les cas de censures aléatoires sont les décès des chefs de gouvernements pendant leur mandat.
  
  
  Avant de commencer notre étude vérifions ce jeu de données est raisonnable (suffisamment de données) pour interpréter nos futurs résultats.
  
Pour cela calculons le pourcentage de censure de l'échantillon.
```{r taux_de_censure, echo = T}
n <- length(df$ehead) #nombre d'individus
delta <- df$observed #vecteur des censures
pourcentage_censure <- 1-sum(delta)/n
cat("Pourcentage de censure :", pourcentage_censure*100, "%")
```
On observe que le pourcentage de données censurées dans l'échantillon est d'environ $19 \%$ ce qui représente 340 individus censurés sur les plus de 1 800. On peut donc raisonnablement se dire que ce jeu de données est adapté à de l'analyse de survie.

 
 Dans notre étude nous avons choisi de regarder l'influence du type de régime sur la durée du mandat d'un chef d'état. La covariable que nous avons choisie d'étudier est qualitative dont les modalités sont : 
  - la monarchie
  - la dictature civile
  - la dictature militaire
  - la démocratie parlementaire
  - la démocratie présidentielle
  - et la démocratie mixte.
 
\newpage
\section{Modèles de survie paramétriques}


Dans les modèles de survie paramétriques, le temps est supposé suivre une certaine distribution dont la fonction de densité de probabilité $f(t)$ peut être exprimée en fonction de paramètres inconnus.  
Une fois qu'une fonction de densité de probabilité est assigniée à la variable de durée, les fonctions de survie et de risque correspondantes peuvent être déterminées.  

Les fonctions de survie $S(x)$ et de risque instantanné $h(x)$ sont reliées de la manière suivante:  


\begin{proposition}
Soit $X : \Omega \longrightarrow \mathbb{R}_+$ une variable aléatoire de densité $f$, de fonction de survie $S$ et de risque instantanné $h$. Alors, on a les relations suivantes :
$$
h(x)= \dfrac{f(x)}{S(x)} = - \dfrac{d}{dx} \log \big(S(x) \big)
$$
\end{proposition}

\subsection{ Modèle de Weibull}



\subsubsection{Modèle de Weibull avec covariables}
\paragraph{Par régime}

Nous choisissons de répartir les régimes en deux classes : les régimes démocratiques et les régimes non-démocratiques.
Les régimes démocratiques comprennent les démocraties mixtes, parlementaires et présidentielles. Les régimes non-démocratiques comprennent les dictatures civiles, militaires et les monarchies.  
Ceci introduit donc une covariable qu'on a nommé *Régime* Voici un extrait du nouveau tableau.


```{r}
#########################################################
################ Survreg  #### covariables ##############
#########################################################

###
### Extrait du tableau
###
sample_dem <- read.csv(file = 'sample_dem.csv', sep = ",", header= TRUE)
knitr::kable(sample_dem,align = 'c')
```





\newpage
```{r, include = F}
#democracy.weib <- flexsurvreg(Surv(duration, observed) ~ democracy, data = df, dist = 'weibull' )
#democracy.llog <- flexsurvreg(Surv(duration, observed) ~ democracy, data = df, dist = 'llogis' )
#democracy.exp <- flexsurvreg(Surv(duration, observed) ~ democracy, data = df, dist = 'exponential' )
#democracy.lnorm <- flexsurvreg(Surv(duration, observed) ~ democracy, data = df, dist = 'lognormal' )
#democracy.ga <- flexsurvreg(Surv(duration, observed) ~ democracy, data = df, dist = 'gamma' )
democracy.gomp <- flexsurvreg(Surv(duration, observed) ~ democracy, data = df, dist = 'gompertz' )

#-2 * democracy.weib$loglik + 4
#-2 * democracy.lnorm$loglik + 4
#-2 * democracy.llog$loglik + 4
#-2 * democracy.exp$loglik + 4

library(flexsurv)

```

\paragraph{Par type de régime}

```{r survreg_weibull, include = F}
df$regime <- factor(df$regime, levels = c("Monarchy","Civilian Dict","Military Dict","Parliamentary Dem","Mixed Dem", "Presidential Dem"))

modweib <- survreg(Surv(df$duration,delta)~df$regime,init = "Monarchy" ,dist='weibull')
summary(modweib)
modweib$coefficients/sqrt(diag(modweib$var)[-7]) # nombre de sigma pour s'annuler
```

```{r densité, include = F}
seq <- seq(0, 5, length.out = 100)
yweib <- dweibull(seq, modweib$coefficients[1], modweib$scale)

hist(df$duration, breaks = 50, freq = F, main = "", ylim = c(0,1.6))
lines(density(df$duration), col ="blue") # méthode à noyau
lines(seq, yweib, type = "l", col = "red")

```

Nous avons choisi la monarchie comme référent (`Intercept`) car c'est la modalité pour laquelle les duréees de vies sont les plus longues en moyenne comme on peut le voir sur une représentation graphique utilisant un estimateur non-paramétrique de Kaplan-Meier. (ou on fait un histogramme)

```{r Kaplan-Meier, include = F}
fit_regime <- survfit(Surv(duration,observed) ~ regime, data = df)

ggsurvplot(fit_regime,
          pval = TRUE, pval.method=T, pval.coord=c(25,0.8), pval.method.coor=c(25,0.9), conf.int = TRUE,
          linetype = "strata", # Change line type by groups
          surv.median.line = "hv", # Specify median survival
          ggtheme = theme_grey(base_size =  11), # Change ggplot2 theme
          break.time.by = 5,
          title="Courbes de survie des différents types de régimes",
          legend = c(0.85,0.809),
          legend.title = "Régimes",
          xlab= "Années", ylab="Probabilité de rester au pouvoir",
          legend.labs = c("Monarchie", "Dict. Civile", "Dict. militaire", "Démoc. mixte", "Démoc. parlementaire", "Démoc. présidentielle")
          )
```



\subsection{Modèle log-logistique}
\subsubsection{Fonction survreg}

\newpage
\section{Conclusion}

méthode non-paramétrique sert à valider la méthode paramétrique.

\newpage 
\section{Annexes et références}
  
  Références :
Cheibub, José Antonio, Jennifer Gandhi, and James Raymond Vreeland. 2010. “Democracy and Dictatorship Revisited.” Public Choice, vol. 143, no. 2-1, pp. 67-101.
